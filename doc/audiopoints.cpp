#include "audiopoints.h"
#include <qmath.h>
#include <random>

//#include <QDebug>

AudioPoints::AudioPoints()
{
    timer = nullptr;
    audioOutput = nullptr;
    m_isPlaying = false;
}

AudioPoints::~AudioPoints()
{
    if (timer != nullptr)
        delete timer;
    if (audioOutput != nullptr)
        delete audioOutput;
}

void AudioPoints::startAudio()
{
    instrument++;
    if (instrument > 3)
        instrument = 0;
    audioPlaying = true;
    initializeAudio();
    writeMoreData();
}

void AudioPoints::stopAudio()
{
    if (audioOutput != nullptr) {
        audioOutput->stop();
        delete audioOutput;
        audioOutput = nullptr;
        timer->stop();
    }
    audioPlaying = false;
    //    setFreq(0);
}

void AudioPoints::setFreq(double freq, bool useNotes, bool n, double ratio)
{
    xx = freq;
    m_n = n;
    //    m_n = false;
    m_ratio = ratio;
    m_isPlaying = true;

    //    xx = xx / 2;


    if (useNotes) {
        if ( xx == 0)
            xx = 0;
        else if ( xx < 110.0)
            xx = 110.0;
        else if ( xx >= 110.0 && xx <  116.54) // A2
            xx = 110;
        else if ( xx >= 116.54 && xx < 123.47) //A#2
            xx = 116.54;
        else if ( xx >= 123.47 && xx < 130.81) //B2
            xx = 123.47;
        else if ( xx >= 130.81 && xx < 138.59) //C3
            xx = 130.81;
        else if ( xx >= 138.59 && xx < 146.83) //C#3
            xx = 138.59;
        else if ( xx >= 146.83 && xx < 155.56) //D3
            xx = 146.83;
        else if ( xx >= 155.56 && xx < 164.81) //D#3
            xx = 155.56;
        else if ( xx >= 164.81 && xx < 174.61) //E3
            xx = 164.81;
        else if ( xx >= 174.61 && xx < 185.00) //F3
            xx = 174.61;
        else if ( xx >= 185.00 && xx < 196.00) //F#3
            xx = 185.00;
        else if ( xx >= 196.00 && xx < 207.65) //G3
            xx = 196.00;
        else if ( xx >= 207.65 && xx < 220.00) //G#3
            xx = 207.65;
        else if ( xx >= 220.0 && xx <  233.08) // A3
            xx = 220.0;
        else if ( xx >= 233.08 && xx < 246.94) //A#3
            xx = 233.08;
        else if ( xx >= 246.94 && xx < 261.63) //B3
            xx = 246.94;
        else if ( xx >= 261.63 && xx < 277.18) //C4
            xx = 261.63;
        else if ( xx >= 277.18 && xx < 293.66) //C#4
            xx = 277.18;
        else if ( xx >= 293.66 && xx < 311.13) //D4
            xx = 293.66;
        else if ( xx >= 311.13 && xx < 329.63) //D#4
            xx = 311.13;
        else if ( xx >= 329.63 && xx < 349.23) //E4
            xx = 329.63;
        else if ( xx >= 349.23 && xx < 369.99) //F4
            xx = 349.23;
        else if ( xx >= 369.99 && xx < 392.00) //F#4
            xx = 369.99;
        else if ( xx >= 392.00 && xx < 415.30) //G4
            xx = 392.00;
        else if ( xx >= 415.30 && xx < 440.00) //G#4
            xx = 415.30;
        else if ( xx >= 440.00 && xx < 466.16) //A4
            xx = 440.0;
        else if ( xx >= 466.16 && xx < 493.88) //A#4
            xx = 466.16;
        else if ( xx >= 493.88 && xx < 523.25) //B4
            xx = 493.88;
        else if ( xx >= 523.25 && xx < 554.37) //C5
            xx = 523.25;
        else if ( xx >= 554.37 && xx < 587.33) //C#5
            xx = 554.37;
        else if ( xx >= 587.33 && xx < 622.25) //D5
            xx = 587.33;
        else if ( xx >= 622.25 && xx < 659.25) //D#5
            xx = 622.25;
        else if ( xx >= 659.25 && xx < 698.46) //E5
            xx = 659.25;
        else if ( xx >= 698.46 && xx < 739.99) //F5
            xx = 698.46;
        else if ( xx >= 739.99 && xx < 783.99) //F#5
            xx = 739.99;
        else if ( xx >= 783.99 && xx < 830.61) //G5
            xx = 783.99;
        else if ( xx >= 830.61 && xx < 880.00) //G#5
            xx = 830.61;
        else if ( xx >= 880.00 && xx < 932.33) //A5
            xx = 880.00;
        else if ( xx >= 932.33 && xx < 987.77) //A#5
            xx = 932.33;
        else if ( xx >= 987.77 && xx < 1046.50) //B5
            xx = 987.77;
        else if ( xx >= 1046.50 && xx < 1108.73) //C6
            xx = 1046.50;
        else if ( xx >= 1108.73 && xx < 1174.66) //C#6
            xx =  1108.73;
        else if ( xx >= 1174.66 && xx < 1244.51) //D6
            xx = 1174.66;
        else if ( xx >= 1244.51 && xx < 1318.51) //D#6
            xx = 1244.51;
        else if ( xx >= 1318.51 && xx < 1396.91) //E6
            xx = 1318.51;
        else if ( xx >= 1396.91 && xx < 1479.98) //F6
            xx = 1396.91;
        else if ( xx >= 1479.98 && xx <  1567.98) //F#6
            xx = 1479.98;
        else if ( xx >= 1567.98 && xx < 1661.22) //G6
            xx = 1567.98;
        else if ( xx >= 1661.22 && xx < 1760.00) //G#6
            xx = 1661.22;
        else if ( xx >= 1760.00 && xx < 1864.66) //A6
            xx = 1760.00;
        else if ( xx >= 1864.66 && xx < 1975.53) //A#6
            xx = 1864.66;
        else if ( xx >= 1975.53 && xx < 2093.00) //B6
            xx = 1975.53;
        else if ( xx >= 2093.00 && xx < 2217.46) //C7
            xx = 2093.00;
        else if ( xx >= 2217.46 && xx < 2349.32) //C#7
            xx = 2217.46;
        else if ( xx >= 2349.32 && xx < 2489.02) //D7
            xx = 2349.32;
        else if ( xx >= 2489.02 && xx < 2637.02) //D#7
            xx = 2489.02;
        else if ( xx >= 2637.02 && xx < 2793.83) //E7
            xx = 2637.02;
        else if ( xx >= 2793.83 && xx < 2959.96) //F7
            xx = 2793.83;
        else if ( xx >= 2959.96)// && xx < 3135.96) //F#7
            xx = 2959.96;
        //        else if ( xx >= 3135.96 && xx < 3322.44) //G7
        //            xx = 3135.96;
        //        else if ( xx >= 3322.44)// && xx <= 3520.00) //A7
        //            xx = 3322.44;
    }

    m_time = 0;
    if (audioPlaying == false)
        startAudio();
}

void AudioPoints::initializeAudio()
{
    deviceinfo = QAudioDeviceInfo::defaultOutputDevice();
    audioOutput = nullptr;

    format.setSampleRate(DataFrequencyHz);
    format.setChannelCount(ChannelCount);
    format.setSampleSize(SampleSize);
    format.setCodec("audio/pcm");
    format.setByteOrder(QAudioFormat::LittleEndian);
    format.setSampleType(QAudioFormat::SignedInt);

    QAudioDeviceInfo info(QAudioDeviceInfo::defaultOutputDevice());
    if (!info.isFormatSupported(format)) {
        format = info.nearestFormat(format);
    }
    audioOutput = new QAudioOutput(deviceinfo, format, this);
    audioOutput->setBufferSize(BufferSize);
    timer = new QTimer;
    timer->setTimerType(Qt::PreciseTimer);
    connect(timer, SIGNAL(timeout()), this, SLOT(writeMoreData()));
    m_time = 0;
    timer->start(TimerMSeconds);
    m_sum = 0;
    m_sum2 = 0;
    m_phi = 0;
    m_phi2 = 0;
    auIObuffer = audioOutput->start();
#ifdef Q_OS_WIN
    //    auIObuffer = audioOutput->start(); //In windows calling audioOutput->start
    //for second time gives better results
#endif
}

void AudioPoints::writeMoreData()
{
    if (m_isPlaying == false)
        return;
    m_time += 5;
    if (m_time > duration) {
        m_isPlaying = false;
        emit finished();
        return;
    }
    int emptyBytes = audioOutput->bytesFree();
    //if (emptyBytes > BufferSize) emptyBytes = BufferSize;// Check how many empty bytes are in the device buffer
    int periodSize = audioOutput->periodSize(); // Check the ideal chunk size, in bytes

    int chunks = emptyBytes/periodSize;

    while (chunks){

        for (int sample=0; sample<periodSize/2; sample += 2) {
            if (xx != xx)
                xx = 0;

            m_sum += xx/DataFrequencyHz;
            m_sum2 += xx2/DataFrequencyHz;
            m_phi = m_sum * 2 * M_PI;
            m_phi2 = m_sum2 * 2 * M_PI;

            m++;
            m_2++;
            if (m > DataFrequencyHz / 4)
                m = 0;
            float time = (float) m/DataFrequencyHz ;

            if (m_2 > DataFrequencyHz / 4)
                m_2 = 0;
            float time2 = (float)m_2/DataFrequencyHz;

            double x = 0;

            //                        if (!m_n) {
            //                            m_f0 = 10;
            //                            m_f1 = 35;
            //                            m_f2 = 5;
            //                            m_f3 = 5;
            //                            m_f4 = 5;
            //                            m_f10 = 0;
            //                        } else {


            //                        }


            //            x = 1/(m_f0 + m_f1 + m_f2 + m_f3 + m_f4 + m_f5 + m_f6 + m_f7 + m_f8 + m_f9 + m_f10) *
            //                    (m_f0 * qSin(m_phi) +
            //                     m_f1 * qSin(2 * m_phi) +
            //                     m_f2 * qSin(3 * m_phi) +
            //                     m_f3 * qSin(4 * m_phi) +
            //                     m_f4 * qSin(5 * m_phi) +
            //                     m_f5 * qSin(6 * m_phi) +
            //                     m_f6 * qSin(7 * m_phi) +
            //                     m_f7 * qSin(8 * m_phi) +
            //                     m_f8 * qSin(9 * m_phi) +
            //                     m_f9 * qSin(10 * m_phi) +
            //                     m_f10 * qSin(11 * m_phi));

            //            double m_f1b = 0;
            //            double m_f2b = 0;
            //            double m_f3b = 0;
            //            double m_f4b = 0;
            //            double m_f5b = 0;
            //            double m_f6b = 0;
            //            double m_f7b = 0;
            //            double m_f8b = 0;

            if (m_n) {
                m_f0 = 1;
                x = m_f0 * qCos(m_phi);
                x = x / 4;
            } else {

                m_f0 = 0.50080738177624;
                m_f1 = 0.068404713833569;
                double m_f1b = -0.08570004679967458;

                m_f2 = 0.11638016756714287;
                double m_f2b = 0.08619758026637078;

                m_f3 =  0.018952966690152943;
                double m_f3b = 0.004422013078731322;

                m_f4 = 0.011979803502457812;
                double m_f4b = -0.007138243655857997;

                m_f5 = 0.05277569941652454;
                double m_f5b = 0.004081262216905334;

                m_f6 = 0.012211357305734426;
                double m_f6b = 0.024505041269833387;

                m_f7 = -0.005088924076429922;
                double m_f7b = 0.0023863432328524005;

                m_f8 = 0.008070561548884065;
                double m_f8b = 0.012397848558466078;

                m_f9 = 0;
                double m_f9b = 0;

                m_f10 = 0;
                double m_f10b = 0;

                double m_f11 = 0;
                double m_f11b = 0;

                x = x + m_f0*qCos(m_phi)
                        + m_f1*qCos(2*m_phi) + m_f1b*qSin(2*m_phi)
                        + m_f2*qCos(3*m_phi) + m_f2b*qSin(3*m_phi)
                        + m_f3*qCos(4*m_phi) + m_f3b*qSin(4*m_phi)
                        + m_f4*qCos(5*m_phi) + m_f4b*qSin(5*m_phi)
                        + m_f5*qCos(6*m_phi) + m_f5b*qSin(6*m_phi)
                        + m_f6*qCos(7*m_phi) + m_f6b*qSin(7*m_phi)
                        + m_f7*qCos(8*m_phi) + m_f7b*qSin(8*m_phi)
                        + m_f8*qCos(9*m_phi) + m_f8b*qSin(9*m_phi)
                        + m_f9*qCos(10*m_phi) + m_f9b*qSin(10*m_phi)
                        + m_f10*qCos(11*m_phi) + m_f10b*qSin(11*m_phi)
                        + m_f11*qCos(12*m_phi) + m_f11b*qSin(12*m_phi);

                m_f0 = -0.0017150833582597182;
                m_f1 = -0.2925943475343732;
                m_f1b = -0.32933365141430926;

                m_f2 =  -0.0041959768279379115;
                m_f2b =  0.015311497027473708;

                m_f3 =  0.19481708338650708;
                m_f3b = 0.22010711166595004;

                m_f4 = -0.03994718936488297;
                m_f4b = 0.03733884183105262;

                m_f5 = 0.2468750576856773;
                m_f5b = 0.10243351325201261;

                m_f6 = -0.010256937378217186;
                m_f6b = 0.029446783480531095;

                m_f7 = 0.052193595335568256;
                m_f7b = -0.06004372690562807;

                m_f8 = 0;
                m_f8b = 0;

                m_f9 = 0;
                m_f9b = 0;

                m_f10 = 0;
                m_f10b = 0;

                m_f11 = 0;
                m_f11b = 0;

//                x = 0;
                x = x + m_f0*qCos(m_phi)
                        + m_f1*qCos(2*m_phi) + m_f1b*qSin(2*m_phi)
                        + m_f2*qCos(3*m_phi) + m_f2b*qSin(3*m_phi)
                        + m_f3*qCos(4*m_phi) + m_f3b*qSin(4*m_phi)
                        + m_f4*qCos(5*m_phi) + m_f4b*qSin(5*m_phi)
                        + m_f5*qCos(6*m_phi) + m_f5b*qSin(6*m_phi)
                        + m_f6*qCos(7*m_phi) + m_f6b*qSin(7*m_phi)
                        + m_f7*qCos(8*m_phi) + m_f7b*qSin(8*m_phi)
                        + m_f8*qCos(9*m_phi) + m_f8b*qSin(9*m_phi)
                        + m_f9*qCos(10*m_phi) + m_f9b*qSin(10*m_phi)
                        + m_f10*qCos(11*m_phi) + m_f10b*qSin(11*m_phi)
                        + m_f11*qCos(12*m_phi) + m_f11b*qSin(12*m_phi);



                double array2[22] = {-0.2925943475343732,
                                     -0.32933365141430926,
                                     -0.0041959768279379115,
                                     0.015311497027473708,
                                     0.19481708338650708,
                                     0.22010711166595004,
                                     -0.03994718936488297,
                                     0.03733884183105262,
                                     0.2468750576856773,
                                     0.10243351325201261,
                                     -0.010256937378217186,
                                     0.029446783480531095,
                                     0.052193595335568256,
                                     -0.06004372690562807};

                                     double array[500] = {-0.0005539696714131163 ,
                                                          5.5692968146054895e-06 ,
                                                          0.00011137449631454993 ,
                                                          -0.003150815235272259 ,
                                                          0.0005881798216173932 ,
                                                          0.001349590251935247 ,
                                                          0.0020594483227027696 ,
                                                          -0.0016618013204727064 ,
                                                          -0.00019792973804803418 ,
                                                          0.0004561251153712715 ,
                                                          0.0008524538949171021 ,
                                                          -0.0013451681135786572 ,
                                                          0.0008952090229606578 ,
                                                          0.0007232673730452118 ,
                                                          -0.00027615219745850397 ,
                                                          -0.0003617909152608273 ,
                                                          0.0015482644257822523 ,
                                                          -0.0001437340124979881 ,
                                                          -0.0006843305455376029 ,
                                                          -0.002894745022166029 ,
                                                          0.001031240936786 ,
                                                          0.0008575693337282907 ,
                                                          0.0003372684819276806 ,
                                                          -2.0990612990534343e-05 ,
                                                          0.0007502326464227074 ,
                                                          -0.00041125088363866386 ,
                                                          0.001458433099636582 ,
                                                          0.00015582721246378407 ,
                                                          0.0004964340300117749 ,
                                                          0.0008536221017135073 ,
                                                          0.0022387822329606173 ,
                                                          0.00041472608702350567 ,
                                                          0.004098992970660042 ,
                                                          -0.000656660853460113 ,
                                                          -0.0006311436521812476 ,
                                                          0.0018233040090037968 ,
                                                          0.0006998344813630783 ,
                                                          -0.0006678144240880543 ,
                                                          0.0006181306061412508 ,
                                                          0.000384674376320438 ,
                                                          0.0014480029907735525 ,
                                                          0.0018341008164700283 ,
                                                          0.0030867995536562 ,
                                                          -0.0009237686660534156 ,
                                                          0.0020794712828296224 ,
                                                          0.0006827965129362935 ,
                                                          -0.023613262993384652 ,
                                                          0.8446957312371156 ,
                                                          -0.014928338782017193 ,
                                                          -0.0013493729248751593 ,
                                                          -0.007132757551979097 ,
                                                          0.00010458252020736388 ,
                                                          -0.0037552921842582583 ,
                                                          -0.001550365450773127 ,
                                                          -0.004566608137715146 ,
                                                          -0.0012877715225247484 ,
                                                          -0.002793120626294052 ,
                                                          -0.0017103504838080663 ,
                                                          -0.003487710972688734 ,
                                                          -0.0014893093216863944 ,
                                                          0.0029196907070849704 ,
                                                          -0.00038308204563400263 ,
                                                          -0.0014980973216832897 ,
                                                          -0.0009936267472151193 ,
                                                          -0.001824889696300728 ,
                                                          -0.0004300861901467919 ,
                                                          -0.0012401031599616479 ,
                                                          -0.0006668857438749335 ,
                                                          -0.002019468205877323 ,
                                                          -0.0007388171184118516 ,
                                                          -0.0018783238075458601 ,
                                                          -0.0014105161705462645 ,
                                                          -0.0017026720934597871 ,
                                                          -0.002230104831956473 ,
                                                          -0.00415289175750623 ,
                                                          0.0015008095214980382 ,
                                                          0.0019185627746726814 ,
                                                          -0.0023673986412261574 ,
                                                          -0.00039146673640123826 ,
                                                          -0.001306301789295305 ,
                                                          -0.0032865794089266395 ,
                                                          5.7376173172739285e-05 ,
                                                          -0.002384890269943945 ,
                                                          -0.001534377816550315 ,
                                                          -0.003712267957272106 ,
                                                          -0.0010061813298354607 ,
                                                          -0.0020703190959537646 ,
                                                          -0.0016107424098677227 ,
                                                          -0.006369829996133831 ,
                                                          -0.0032766905797338283 ,
                                                          -0.009010838156532409 ,
                                                          -0.0036471545241907703 ,
                                                          -0.012270085715036369 ,
                                                          -0.0075151339297572246 ,
                                                          -0.07796855266678292 ,
                                                          -0.06247641743172186 ,
                                                          0.012784854121463676 ,
                                                          0.008692575665527953 ,
                                                          0.010464991097995788 ,
                                                          -0.000348583606324478 ,
                                                          0.005163246746954688 ,
                                                          0.002554337213059304 ,
                                                          0.003685057964237247 ,
                                                          0.0003964891861258068 ,
                                                          0.001598003482450742 ,
                                                          -0.00030071973516880205 ,
                                                          0.0029236908142036924 ,
                                                          0.0005150169773831096 ,
                                                          0.0028093137342317252 ,
                                                          0.0013730024218967108 ,
                                                          0.0017303596018658188 ,
                                                          0.0006144777787116754 ,
                                                          0.0003831028872159899 ,
                                                          -0.001584798392787535 ,
                                                          0.0002016847568014826 ,
                                                          -0.0011364542472061434 ,
                                                          0.0010768173460688935 ,
                                                          6.395891020940093e-05 ,
                                                          0.0007418566933556003 ,
                                                          0.0002539187620533665 ,
                                                          0.001202737663968131 ,
                                                          0.0005920098076094878 ,
                                                          -0.0006907130979811827 ,
                                                          0.002510338344711833 ,
                                                          0.000392485255551142 ,
                                                          0.0005853101623064296 ,
                                                          0.0016105590957901268 ,
                                                          -0.0006928333280111391 ,
                                                          0.00371202230764682 ,
                                                          -0.0016386867260737754 ,
                                                          0.0009688447617534983 ,
                                                          0.0019538129096238646 ,
                                                          0.00017608451343675984 ,
                                                          0.0012808810269943221 ,
                                                          0.0008593929578260815 ,
                                                          0.0007106950607601441 ,
                                                          0.001383542883942048 ,
                                                          0.00016524185115810212 ,
                                                          0.0008147541708938077 ,
                                                          -0.0009696904276105906 ,
                                                          -0.0029372678128099 ,
                                                          0.0010986354980647075 ,
                                                          0.11490163000730133 ,
                                                          0.09173613438124191 ,
                                                          -0.0010489170838297755 ,
                                                          0.0035337868778464055 ,
                                                          -0.00027949398260574955 ,
                                                          0.0019043991011922744 ,
                                                          -0.0015051334459567167 ,
                                                          4.399290226795725e-05 ,
                                                          0.00024521054159012083 ,
                                                          0.0009866322374644943 ,
                                                          -0.0007134758000949537 ,
                                                          -0.0013703888204804986 ,
                                                          -0.0013523637771780431 ,
                                                          0.0011196993889501174 ,
                                                          0.0013010078763908675 ,
                                                          -0.0013183300269777995 ,
                                                          0.0006369833261350071 ,
                                                          0.00031686065540795 ,
                                                          0.0003182818882580325 ,
                                                          0.0008517228210884592 ,
                                                          -0.00018774694290331814 ,
                                                          0.001614601503481311 ,
                                                          0.0012903601642434656 ,
                                                          -0.00037273437246495596 ,
                                                          -0.0009095109088514423 ,
                                                          0.0006670222313783631 ,
                                                          -0.00033987401337093976 ,
                                                          -0.0009683178025405619 ,
                                                          0.0017584857744330936 ,
                                                          -0.0003557282079090414 ,
                                                          0.0016845945852654184 ,
                                                          0.0012825803868607728 ,
                                                          0.0005362237275981412 ,
                                                          0.0005158618825914657 ,
                                                          0.000483806631236181 ,
                                                          0.00019516456191118016 ,
                                                          -8.129593741678608e-05 ,
                                                          -0.0008894900095848837 ,
                                                          0.00025260215029243284 ,
                                                          0.0003733183852473544 ,
                                                          -3.825615658802061e-05 ,
                                                          -0.0020001462511666074 ,
                                                          0.0006836920701239962 ,
                                                          -0.0003022333951215452 ,
                                                          -0.00016520914101894677 ,
                                                          -8.076398329150799e-05 ,
                                                          -0.00023031291861031923 ,
                                                          -0.0008352025491090154 ,
                                                          0.0036931722496383553 ,
                                                          -0.011071064096300598 ,
                                                          0.0015843026186468533 ,
                                                          0.0021535256340242566 ,
                                                          -0.00040983966666269646 ,
                                                          5.9410097011564426e-05 ,
                                                          0.001421408043734545 ,
                                                          0.0018168046066170305 ,
                                                          0.0010349993554713685 ,
                                                          0.0002587327274359818 ,
                                                          0.00021336456515066768 ,
                                                          0.000129874699538487 ,
                                                          0.0007978405293624574 ,
                                                          -0.00037451121880510647 ,
                                                          0.0010584677497194502 ,
                                                          -0.0015610683325365847 ,
                                                          0.0004155621992716127 ,
                                                          0.001190998465295586 ,
                                                          -0.001069281826175854 ,
                                                          -0.0007224774401156132 ,
                                                          0.0005871035902348152 ,
                                                          0.00040370193320607526 ,
                                                          0.000187734563391042 ,
                                                          0.0005674696975373248 ,
                                                          8.756968272261822e-06 ,
                                                          -0.0011188575666371586 ,
                                                          0.0005522622239744299 ,
                                                          -8.274597544280205e-05 ,
                                                          0.00029721705519054957 ,
                                                          0.0001373860514872015 ,
                                                          -0.003551136442664447 ,
                                                          0.0004329119682959692 ,
                                                          -0.0001814419884568443 ,
                                                          5.858620944657231e-05 ,
                                                          -0.00018175055556060257 ,
                                                          -0.0014547475599428197 ,
                                                          0.0009640429835038167 ,
                                                          0.00040109015527844407 ,
                                                          -0.0004503217546729988 ,
                                                          0.0002843397450817674 ,
                                                          0.0016821206732662557 ,
                                                          0.000831270162589196 ,
                                                          0.0006356372170945847 ,
                                                          0.0008747824809880773 ,
                                                          0.00040115546381768434 ,
                                                          -0.00015258939099546302 ,
                                                          0.0002930142483626741 ,
                                                          -0.0011789419924465247 ,
                                                          0.008820907904071662 ,
                                                          -0.00906095965846829 ,
                                                          0.003388410460849025 ,
                                                          -0.0012463292121470957 ,
                                                          0.002755185914542051 ,
                                                          0.00040289036573638973 ,
                                                          -0.00041687288128773055 ,
                                                          0.00024239391483600966 ,
                                                          0.0007712065686992016 ,
                                                          0.0015664126688152869 ,
                                                          -0.00030080450050917003 ,
                                                          -0.0003883531266442521 ,
                                                          0.00025886266484717965 ,
                                                          0.00033173875381610225 ,
                                                          0.0008626782123715869 ,
                                                          -0.0008201635105102238 ,
                                                          7.06630604355083e-05 ,
                                                          -0.0009016884802456706 ,
                                                          -8.204544198740969e-05 ,
                                                          -3.1015973558245136e-05 ,
                                                          0.0005203212798196232 ,
                                                          0.000152979594578063 ,
                                                          -0.0002011001728421651 ,
                                                          -0.000197656380254268 ,
                                                          -0.0007245847983900923 ,
                                                          0.0011502328530946483 ,
                                                          -0.0007542175974787496 ,
                                                          -0.000499254075755587 ,
                                                          -0.0001866478934723609 ,
                                                          0.00016951418882288498 ,
                                                          0.0022407775705304577 ,
                                                          -0.00032860291846434727 ,
                                                          0.0009048510688084182 ,
                                                          -0.0007482146631821356 ,
                                                          0.001362453020528859 ,
                                                          -0.0002893897742623052 ,
                                                          0.0007872374356280088 ,
                                                          8.967923087451187e-05 ,
                                                          0.0007557785175372876 ,
                                                          -0.0011657616270450359 ,
                                                          0.00016946834728010301 ,
                                                          -0.0009587243768404361 ,
                                                          -0.00046932596235869716 ,
                                                          -0.0018196313663600922 ,
                                                          0.0012989901208934878 ,
                                                          0.00014680829934571492 ,
                                                          0.0013336547534174201 ,
                                                          0.0009973368693103892 ,
                                                          0.0015156557813992648 ,
                                                          -0.0018203429569617832 ,
                                                          0.0013309410503909262 ,
                                                          -0.00038084086634652785 ,
                                                          0.0011058766271101362 ,
                                                          4.489647846147012e-06 ,
                                                          0.0017767503794169734 ,
                                                          -0.0011361507543526939 ,
                                                          0.008298837536665708 ,
                                                          -0.0015851418587971842 ,
                                                          -0.0037859459785413918 ,
                                                          0.0003140176920214069 ,
                                                          -0.0010938466101989381 ,
                                                          0.0009104303526087734 ,
                                                          0.0003806679609009431 ,
                                                          0.0013467753393527182 ,
                                                          -0.0002846514022068175 ,
                                                          0.0011896982187997599 ,
                                                          -0.0008913352703032803 ,
                                                          0.00033479587328886574 ,
                                                          -0.0007617890581920195 ,
                                                          9.729670558653587e-05 ,
                                                          -0.0002548327638749459 ,
                                                          -0.0032943630157544106 ,
                                                          -0.00044067076173043935 ,
                                                          -0.00013856570578690854 ,
                                                          0.0012333041480255297 ,
                                                          6.319172788027805e-05 ,
                                                          0.0004913609969871837 ,
                                                          0.0001663805131790758 ,
                                                          -0.0006505894602320836 ,
                                                          0.0011982277716179274 ,
                                                          -0.0005716263839029537 ,
                                                          0.0008839822398415292 ,
                                                          -0.0008751025793734856 ,
                                                          0.0009947498508580223 ,
                                                          0.0016630828257445062 ,
                                                          -0.000998170020585702 ,
                                                          -0.0009173756977330548 ,
                                                          0.00018096714553615304 ,
                                                          0.00039750229765241627 ,
                                                          -0.0005203199592680182 ,
                                                          0.0001650646400388638 ,
                                                          0.0016807381987619097 ,
                                                          -4.927673627041675e-05 ,
                                                          -0.0003326592513863263 ,
                                                          -0.0013418772371632417 ,
                                                          -0.00030942601522655576 ,
                                                          0.003139732391348995 ,
                                                          0.0016548626272407118 ,
                                                          0.0005059466700131207 ,
                                                          0.001536652894105479 ,
                                                          0.0010057561848173119 ,
                                                          0.00028372488216657125 ,
                                                          -0.0002885423302328858 ,
                                                          0.00010083297134015161 ,
                                                          -0.005665318360182573 ,
                                                          0.0010171343765819718 ,
                                                          0.0008633936215035109 ,
                                                          0.0008987762412172269 ,
                                                          0.0010759714691618517 ,
                                                          0.00014539732954401113 ,
                                                          0.0015270006971385872 ,
                                                          -0.0009059107080988719 ,
                                                          -0.0010931763317956588 ,
                                                          -0.0004090222678317266 ,
                                                          -6.13560090515597e-05 ,
                                                          0.0002951633612922623 ,
                                                          0.0009663396345548181 ,
                                                          0.00025056609354519646 ,
                                                          0.0006601103855165156 ,
                                                          0.001214620471098026 ,
                                                          0.0008879721967513931 ,
                                                          -0.00017169666802767017 ,
                                                          0.00015244062638022714 ,
                                                          0.000691170072588693 ,
                                                          0.00048423052326814045 ,
                                                          0.0008883887055009274 ,
                                                          0.0007661503875593229 ,
                                                          -0.0017197639098146613 ,
                                                          6.328976807081956e-05 ,
                                                          -0.00057663348636019 ,
                                                          0.00015436585563739392 ,
                                                          -0.0014535874072516787 ,
                                                          -0.0005235343104864115 ,
                                                          -0.00026694100164516223 ,
                                                          -0.0009718823090181634 ,
                                                          -0.0006644110562504781 ,
                                                          -0.0012144972204492011 ,
                                                          -0.001948794171977766 ,
                                                          -0.0025406759985100898 ,
                                                          -0.0007663820227140373 ,
                                                          0.0016264338789538984 ,
                                                          -0.0005246669243031975 ,
                                                          0.0014753419564058226 ,
                                                          -0.00027014688905737115 ,
                                                          0.0007896365767306524 ,
                                                          -0.003336212962077199 ,
                                                          0.00019387175352530734 ,
                                                          -0.0018423990799301452 ,
                                                          0.00028929458796628075 ,
                                                          -0.0026105872141657573 ,
                                                          0.0018265484293381064 ,
                                                          -0.0030766701590246247 ,
                                                          0.005582447504644678 ,
                                                          -0.014972635802568466 ,
                                                          -0.0015391603705015992 ,
                                                          0.005969192598381619 ,
                                                          -0.0010156368803833843 ,
                                                          0.0020222710615799048 ,
                                                          -0.0011323179402661816 ,
                                                          0.0013054731056730898 ,
                                                          -0.00024705786657747494 ,
                                                          0.0017210010560742037 ,
                                                          -0.0006654869891885633 ,
                                                          0.001244465089637275 ,
                                                          -0.00088772144532463 ,
                                                          0.0002549833294866201 ,
                                                          -0.005064451776090249 ,
                                                          -0.0030898875084516696 ,
                                                          0.0009728040414718167 ,
                                                          0.001389319513155747 ,
                                                          0.0005696037696888051 ,
                                                          0.001310711451669554 ,
                                                          -0.00030189746518513805 ,
                                                          -5.250026025777866e-05 ,
                                                          0.001127523508873184 ,
                                                          -0.0002144073671151569 ,
                                                          0.0009310439555539055 ,
                                                          0.0012341572125758916 ,
                                                          0.00012566865688005055 ,
                                                          -7.870422713354972e-06 ,
                                                          0.0023563522510938483 ,
                                                          -0.0020347613556325494 ,
                                                          0.00031955420941898795 ,
                                                          0.001031346392763207 ,
                                                          -0.0007689842156127632 ,
                                                          0.0010293410561817236 ,
                                                          0.00016120958944707648 ,
                                                          0.0004394279778528101 ,
                                                          0.0006920948889814582 ,
                                                          -0.0006073104869133284 ,
                                                          -0.0001628822945896373 ,
                                                          -4.477376138435141e-05 ,
                                                          0.0022551275155996823 ,
                                                          0.00028580832275979873 ,
                                                          0.0004964927950254697 ,
                                                          0.002063482833172348 ,
                                                          -0.00037516972729428373 ,
                                                          -0.0002982159740860584 ,
                                                          -0.00045269255918687176 ,
                                                          0.0009770441097964556 ,
                                                          -0.0011925568938541526 ,
                                                          0.00041841576842232056 ,
                                                          0.0005061069399023285 ,
                                                          8.862403998726374e-05 ,
                                                          0.00010475591871089807 ,
                                                          0.00015774768227884415 ,
                                                          0.00033215547068334765 ,
                                                          0.0007756828448342784 ,
                                                          -0.001466569216523464 ,
                                                          0.00024369601275589652 ,
                                                          -0.00013380958775027687 ,
                                                          -0.00033534628857736495 ,
                                                          -0.0009425440295118481 ,
                                                          0.0006362507924617415 ,
                                                          9.302740259882392e-05 ,
                                                          0.0012099755093323004 ,
                                                          -0.0008834713335650718 ,
                                                          1.4887408438775007e-05 ,
                                                          -0.000769512554424576 ,
                                                          0.0009956627178760898 ,
                                                          -0.0001815052353881694 ,
                                                          0.0004242310005440765 ,
                                                          0.0005472571586299357 ,
                                                          -0.0020278272126048316 ,
                                                          0.0001897178247599472 ,
                                                          -0.0008396090893262187 ,
                                                          0.00012544834971600863 ,
                                                          -0.0006436956852292186 ,
                                                          -0.0005096193475598997 ,
                                                          -0.000745744057421876 ,
                                                          -0.0006359712874252252 ,
                                                          -0.0012480414437364706 ,
                                                          -0.0014271068791220907 ,
                                                          -0.0009743091341916567 ,
                                                          -0.0021009003816777434 ,
                                                          -0.0018089465766196555 ,
                                                          0.0016760765668474551 ,
                                                          -0.00011330682557783877 ,
                                                          0.0017599922459253857 ,
                                                          -8.572934055297919e-05 ,
                                                          -0.0007333530817508894 ,
                                                          -0.0010044002634608017 ,
                                                          0.0012010194302323166 ,
                                                          -0.0012303952182387806 ,
                                                          0.0014341498109177065 ,
                                                          0.00017204878806828102 ,
                                                          0.001709349084466428 ,
                                                          -0.0032167978085999734 ,
                                                          0.006327074124467779 ,
                                                          -0.01426796471940349 ,
                                                          -0.0015962727182561379 ,
                                                          0.006395193259581083 ,
                                                          -0.0010884041943891717 ,
                                                          0.001863626539403568 ,
                                                          -0.0011828329185592883 ,
                                                          0.0007028248087102517 ,
                                                          0.0003339004295860825 ,
                                                          0.0008986978514437211 ,
                                                          -0.00044762779045703867 ,
                                                          0.0009030548892830343 ,
                                                          -0.000802434858020582 ,
                                                          0.0001600616047213822};

                                     x = 0;
                                     int j = 1;
                                     x = -0.0017150833582597182*qCos(m_phi);
                                     for (int i = 0; i < 14; i+=2) {
                                         j++;
                                         //                qDebug() << j;
                                         x = x + array2[i]*qCos((j)*m_phi) + array2[i+1]*qSin((j)*m_phi);
                                     }



                                     //                        m_f0 = 0.005243047967657343;
                                     //                        m_f1 = 0.19332480296779833;
                                     //                        double m_f1b = 0.03347251909168515;

                                     //                        m_f2 =  -0.14669541779106976;
                                     //                        double m_f2b =  0.43668324074365894;

                                     //                        m_f3 =  0.03439894184977748;
                                     //                        double m_f3b = 0.16546130949426988;

                                     //                        m_f4 = -0.1616321184606104;
                                     //                        double m_f4b = 0.019774129792725983;

                                     //                        m_f5 = -0.09897921981887356;
                                     //                        double m_f5b = 0.01378346741243681;

                                     //                        m_f6 = 0.09102645590418874;
                                     //                        double m_f6b = -0.09375565950452396;

                                     //                        m_f7 = 0.024446668206020362;
                                     //                        double m_f7b = -0.008128320324122001;

                                     //                        m_f8 = -0.04135711529532509;
                                     //                        double m_f8b = 0.012099865616305189;

                                     //                        m_f9 = 0.006906842946966191;
                                     //                        double m_f9b = -0.08047175177863318;

                                     //                        m_f10 = 0.017601462234348605;
                                     //                        double m_f10b = 0.00033443660489691996;

                                     //                        double m_f11 = -0.0030628551136363843;
                                     //                        double m_f11b = 0.003059440559440593;


                                     //            x = m_f0*qCos(m_phi)
                                     //                    + m_f1*qCos(2*m_phi) + m_f1b*qSin(2*m_phi)
                                     //                    + m_f2*qCos(3*m_phi) + m_f2b*qSin(3*m_phi)
                                     //                    + m_f3*qCos(4*m_phi) + m_f3b*qSin(4*m_phi)
                                     //                    + m_f4*qCos(5*m_phi) + m_f4b*qSin(5*m_phi)
                                     //                    + m_f5*qCos(6*m_phi) + m_f5b*qSin(6*m_phi)
                                     //                    + m_f6*qCos(7*m_phi) + m_f6b*qSin(7*m_phi)
                                     //                    + m_f7*qCos(8*m_phi) + m_f7b*qSin(8*m_phi)
                                     //                    + m_f8*qCos(9*m_phi) + m_f8b*qSin(9*m_phi)
                                     //                    + m_f9*qCos(10*m_phi) + m_f9b*qSin(10*m_phi)
                                     //                    + m_f10*qCos(11*m_phi) + m_f10b*qSin(11*m_phi)
                                     //                    + m_f11*qCos(12*m_phi) + m_f11b*qSin(12*m_phi);


                                     x = x/4;

                                    }


                                    //            if (instrument == 0) {
                                    //                x = qSin(m_phi);
                                    //            } else if (instrument == 1) {
                                    //                x = 1/1 * (0.1155 * qSin(m_phi) +
                                    //                           0.3417 * qSin(2 * m_phi) +
                                    //                           0.1789 * qSin(3 * m_phi) +
                                    //                           0.1232 * qSin(4 * m_phi) +
                                    //                           0.0678 * qSin(5 * m_phi) +
                                    //                           0.0473 * qSin(6 * m_phi) +
                                    //                           0.0260 * qSin(7 * m_phi) +
                                    //                           0.0045 * qSin(8 * m_phi) +
                                    //                           0.0020 * qSin(9 * m_phi) );
                                    //            } else if (instrument == 2) {
                                    //                x = 1/4.2 * (0.75 * qSin(m_phi) +
                                    //                                    0.3 * qSin(2 * m_phi) +
                                    //                                    0.8 * qSin(3 * m_phi) +
                                    //                                    1.0 * qSin(4 * m_phi) +
                                    //                                    0.75 * qSin(5 * m_phi) +
                                    //                                    0.3 * qSin(6 * m_phi) +
                                    //                                    0.2 * qSin(7 * m_phi) +
                                    //                                    0.1 * qSin(8 * m_phi) );
                                    //            } else {
                                    //                x = 1/5.65 * (0.4 * qSin(m_phi) +
                                    //                           0.8 * qSin(2 * m_phi) +
                                    //                           1.0 * qSin(3 * m_phi) +
                                    //                           0.8 * qSin(4 * m_phi) +
                                    //                           0.6 * qSin(5 * m_phi) +
                                    //                           0.5 * qSin(6 * m_phi) +
                                    //                           0.45 * qSin(7 * m_phi) +
                                    //                           0.4 * qSin(8 * m_phi) +
                                    //                           0.3 * qSin(9 * m_phi) +
                                    //                           0.3 * qSin(10 * m_phi) +
                                    //                           0.3 * qSin(11 * m_phi) +
                                    //                           0.2 * qSin(12 * m_phi));
                                    //            }


                                    //            double x = 0.8 * qSin(m_phi) +
                                    //                    0.1 * qSin(2 * m_phi) +
                                    //                    0.05 * qSin(3 * m_phi) +
                                    //                    0.025 * qSin(4 * m_phi) +
                                    //                    0.025 * qSin(5 * m_phi);

                                    //            double x = 1/16.5 * (1.0 * qSin(m_phi) +
                                    //                    9.0 * qSin(2 * m_phi) +
                                    //                    4.0 * qSin(3 * m_phi) +
                                    //                    2.0 * qSin(4 * m_phi) +
                                    //                    0.5 * qSin(5 * m_phi));

                                    //            double x = 1/1.6 * (1.0 * qSin(m_phi) +
                                    //                    0.1 * qSin(2 * m_phi) +
                                    //                    0.35 * qSin(3 * m_phi) +
                                    //                    0.05 * qSin(4 * m_phi) +
                                    //                    0.05 * qSin(5 * m_phi) +
                                    //                    0.05 * qSin(6 * m_phi) );

                                    if (time > 0.05)
                                    time = 0;

                if (time2 > 0.1)
                    time2 = 0;

                float x2 = qSin(2 * M_PI * 4000 * time);
                float x3 = qSin(2 * M_PI * 200 * time2);

                float x_x = 1.0 * x + 0.0 * x2 + 0.0 * x3;

                signed short value = static_cast<signed short>(x_x * 32767);

                if (xx == 0) {
                    std::normal_distribution<double> dist(m_mean, m_stddev);
                    value += dist(m_generator);
                    aubuffer[sample] = value;
                    aubuffer[sample + 1] = value;
                } else {
                    aubuffer[sample] = value;
                    aubuffer[sample + 1] = value;
                    //                if (m_ratio < 0.5) {
                    //                    aubuffer[sample] = value * m_ratio * 2;
                    //                    aubuffer[sample + 1] = 0;
                    //                } else {
                    //                    aubuffer[sample] = 0;
                    //                    aubuffer[sample + 1] = (-2 * m_ratio + 2) * value ;
                    //                }
                }
            }

            auIObuffer->write((const char*) &aubuffer[0], periodSize);
            --chunks;
        }
    }

    double AudioPoints::f10() const
    {
        return m_f10;
    }

    void AudioPoints::setF10(double f10)
    {
        m_f10 = f10;
    }

    double AudioPoints::f9() const
    {
        return m_f9;
    }

    void AudioPoints::setF9(double f9)
    {
        m_f9 = f9;
    }

    double AudioPoints::f8() const
    {
        return m_f8;
    }

    void AudioPoints::setF8(double f8)
    {
        m_f8 = f8;
    }

    double AudioPoints::f7() const
    {
        return m_f7;
    }

    void AudioPoints::setF7(double f7)
    {
        m_f7 = f7;
    }

    double AudioPoints::f6() const
    {
        return m_f6;
    }

    void AudioPoints::setF6(double f6)
    {
        m_f6 = f6;
    }

    double AudioPoints::f5() const
    {
        return m_f5;
    }

    void AudioPoints::setF5(double f5)
    {
        m_f5 = f5;
    }

    double AudioPoints::f4() const
    {
        return m_f4;
    }

    void AudioPoints::setF4(double f4)
    {
        m_f4 = f4;
    }

    double AudioPoints::f3() const
    {
        return m_f3;
    }

    void AudioPoints::setF3(double f3)
    {
        m_f3 = f3;
    }

    double AudioPoints::f2() const
    {
        return m_f2;
    }

    void AudioPoints::setF2(double f2)
    {
        m_f2 = f2;
    }

    double AudioPoints::f1() const
    {
        return m_f1;
    }

    void AudioPoints::setF1(double f1)
    {
        m_f1 = f1;
    }

    double AudioPoints::f0() const
    {
        return m_f0;
    }

    void AudioPoints::setF0(double f0)
    {
        m_f0 = f0;
    }
